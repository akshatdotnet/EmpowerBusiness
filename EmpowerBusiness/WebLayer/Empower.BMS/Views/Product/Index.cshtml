@model X.PagedList.IPagedList<Product>
@using Empower.Web.Data.Entity
@using X.PagedList.Mvc.Core
@{
    ViewData["Title"] = "Product Management";
}

<h2>Product Management</h2>

<!-- Search Box -->
<form method="get">
    <input type="text" name="search" value="@ViewData["CurrentFilter"]" placeholder="Search..." />
    <button type="submit">Search</button>
</form>

<!-- Add Button -->
<button class="btn btn-primary" onclick="openModal(0)">Add Product</button>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>
                <a asp-action="Index" asp-route-sortOrder="@ViewData["NameSortParam"]">Name</a>
            </th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Category</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var product in Model)
        {
            <tr>
                <td>@product.Name</td>
                <td>@product.Price</td>
                <td>@product.Quantity</td>
                <td>@product.Category</td>
                <td>
                    <button class="btn btn-sm btn-warning" onclick="openModal(@product.Id)">Edit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteProduct(@product.Id)">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Pagination -->
<div>
    @Html.PagedListPager(Model, page => Url.Action("Index", new { page, search = ViewData["CurrentFilter"] }))
</div>

<!-- Bootstrap Modal -->
<div class="modal" id="productModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Product</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="Id" />
                <input type="text" id="Name" placeholder="Name" />
                <input type="number" id="Price" placeholder="Price" />
                <input type="number" id="Quantity" placeholder="Quantity" />
                <input type="text" id="Category" placeholder="Category" />
            </div>
            <div class="modal-footer">
                <button onclick="saveProduct()" class="btn btn-success">Save</button>
            </div>
        </div>
    </div>
</div>

@* <script>
    function openModal(id) {
        if (id === 0) {
            $('#Id').val('');
            $('#Name').val('');
            $('#Price').val('');
            $('#Quantity').val('');
            $('#Category').val('');
        }
        $('#productModal').modal('show');
    }

    function saveProduct() {
        var product = {
            Id: $('#Id').val(),
            Name: $('#Name').val(),
            Price: $('#Price').val(),
            Quantity: $('#Quantity').val(),
            Category: $('#Category').val()
        };
        $.post('/Product/CreateOrUpdate', product, function (res) {
            if (res.success) location.reload();
        });
    }

    function deleteProduct(id) {
        $.post('/Product/Delete', { id: id }, function (res) {
            if (res.success) location.reload();
        });
    }
</script> *@


<script>
    function openModal(id) {
        debugger;
        if (id === 0) { // Add new
            $('#Id').val('');
            $('#Name').val('');
            $('#Price').val('');
            $('#Quantity').val('');
            $('#Category').val('');
        } else { // Edit existing
            $.get(`/Product/GetById/${id}`, function (data) {                         
                $('#Id').val(data.id);
                $('#Name').val(data.name);
                $('#Price').val(data.price);
                $('#Quantity').val(data.quantity);
                $('#Category').val(data.category);
            });
        }
        $('#productModal').modal('show');
    }

    function saveProduct() {
        var product = {
            Id: $('#Id').val(),
            Name: $('#Name').val(),
            Price: $('#Price').val(),
            Quantity: $('#Quantity').val(),
            Category: $('#Category').val()
        };
        $.post('/Product/CreateOrUpdate', product, function (res) {
            if (res.success) location.reload();
        });
    }

    function deleteProduct(id) {
        if (confirm("Are you sure you want to delete this product?")) {
            $.post('/Product/Delete', { id: id }, function (res) {
                if (res.success) location.reload();
            });
        }
    }
</script>

